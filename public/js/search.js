const form=document.getElementById("form1"),form_title=document.getElementById("title"),not_title_warning=document.querySelector(".not_title_warning"),html_container=document.querySelector(".html_container"),html_info_book=document.querySelector(".info_container"),html_favorite_img=document.querySelector(".img_favorite"),html_fav_book=document.querySelector(".info_container_fav"),html_back=document.querySelector(".img_start"),modal=document.getElementById("myModal"),modal_fav=document.getElementById("myModal_fav"),btn=document.querySelector(".html_container"),btn_fav=document.querySelector(".img_favorite"),span=document.getElementsByClassName("close")[0],span_fav=document.getElementsByClassName("close_fav")[0],validate_title=()=>form_title.value.trim().length>0||(not_title_warning.style.display="block",setTimeout(()=>{not_title_warning.style.display="none"},2e3),!1),create_url=(e,t)=>{const n="https://www.googleapis.com/books/v1/volumes";return"search_for_text"==e?n+"?q="+t:"search_for_info"==e?n+"/"+t:n},search_book=(e,t)=>{const n=create_url(e,t);fetch(n).then(e=>e.ok?Promise.resolve(e):Promise.reject(e)).then(e=>e.json()).then(e=>view_book(e.items)).catch(e=>console.log(e))},read_favorite=(e,t)=>!!localStorage.getItem(e+"_"+t),view_book=e=>{if(e){const o=document.createDocumentFragment();let a=0;for(let i=0;i<e.length;i++){const{imageLinks:l,title:r}=e[i].volumeInfo,s=document.createElement("DIV"),c=document.createElement("IMG"),m=document.createElement("IMG"),d=document.createElement("P");let _="./images/descarga (3).png";if(s.setAttribute("class","grid_item"),l){const{smallThumbnail:e}=l;c.setAttribute("src",e),_=e}else c.setAttribute("src",_);c.setAttribute("class","img"),t=sessionStorage.getItem("active"),n=e[i].id,localStorage.getItem(t+"_"+n)?(m.setAttribute("src","./images/images (3).jfif"),m.setAttribute("class","select_favorite"),a++):(m.setAttribute("src","./images/images.png"),m.setAttribute("class","favorite")),m.dataset.key=e[i].id,m.dataset.action="favorite",m.dataset.img=_,m.dataset.title=r,c.dataset.key=e[i].id,c.dataset.action="info",d.setAttribute("class","p_title"),d.textContent=r,s.appendChild(c),s.appendChild(m),s.appendChild(d),o.appendChild(s)}html_container.appendChild(o),html_favorite_img.src=a>0?"./images/images (3).jfif":"./images/descarga.png"}else{const e=document.createElement("DIV");e.textContent="There are no results found for the search ",e.classList.add("result_warning"),html_container.appendChild(e)}var t,n},delete_node_book=()=>{if(html_container.children.length>0){const e=html_container.children.length;for(let t=0;t<e;t++)html_container.removeChild(html_container.children[0])}},search_info=(e,t)=>{const n=create_url(e,t);fetch(n).then(e=>e.ok?Promise.resolve(e):Promise.reject(e)).then(e=>e.json()).then(e=>view_info(e)).catch(e=>console.log(e))},view_info=e=>{const t=document.createDocumentFragment(),{authors:n,categories:o,description:a,dimensions:i,imageLinks:l,language:r,pageCount:s,publishedDate:c,publisher:m,title:d}=e.volumeInfo,{smallThumbnail:_}=l,{width:h,height:g}=i,f=document.createElement("IMG");f.setAttribute("src",_);const u=document.createElement("H3");u.textContent="Title: "+d;const p=document.createElement("DIV");p.appendChild(f),p.appendChild(u),t.appendChild(p);const v=document.createElement("DIV"),b=document.createElement("P");for(const e of n)b.textContent="Authors: "+e+" ";v.appendChild(b);const y=document.createElement("P");for(const e of o)y.textContent="Categories: "+e+" ";v.appendChild(y);const k=document.createElement("P");k.textContent="Dimensions : Width ="+h+" Height ="+g,v.appendChild(k);const C=document.createElement("P");C.textContent="Language: "+r,v.appendChild(C);const E=document.createElement("P");E.textContent="Page Count: "+s,v.appendChild(E);const I=document.createElement("P");I.textContent="Published Date: "+c,v.appendChild(I);const S=document.createElement("P");S.textContent="Publisher: "+m,v.appendChild(S),t.appendChild(v);const x=document.createElement("DIV"),D=document.createElement("P");D.textContent="Description: "+a,x.appendChild(D),t.appendChild(x),html_info_book.appendChild(t)},create_favorite=(e,t,n,o)=>({key:e,img:t,user:n,title:o}),add_favorite=(e,t,n)=>{if(sessionStorage.getItem("active")){const o=create_favorite(e,t,sessionStorage.getItem("active"),n);localStorage.setItem(sessionStorage.getItem("active")+"_"+e,JSON.stringify(o))}},style_favorite=e=>{e.target.src="./images/images (3).jfif",e.target.classList.replace("favorite","select_favorite"),"http://localhost:3000/images/descarga.png"==html_favorite_img.src&&(html_favorite_img.src="./images/images (3).jfif")};html_container.addEventListener("click",e=>{e.preventDefault();const t=e.target.dataset.key,n=e.target.dataset.action;t.length>0&&"info"==n?(modal.style.display="block",search_info("search_for_info",t)):t.length>0&&"favorite"==n?(add_favorite(t,e.target.dataset.img,e.target.dataset.title),style_favorite(e)):console.log("the key does not exist")});const delete_node_info=()=>{if(html_info_book.children.length>0){const e=html_info_book.children.length;for(let t=0;t<e;t++)html_info_book.removeChild(html_info_book.children[0])}};form.addEventListener("submit",e=>{e.preventDefault(),delete_node_book();try{form_title.value.trim().length>0||(not_title_warning.style.display="block",setTimeout(()=>{not_title_warning.style.display="none"},2e3),0)?(search_book("search_for_text",form_title.value),form.reset()):console.log("mensaje de error")}catch(e){throw e}});const select_favorite=e=>{let t=[],n=0;for(let o=0;o<localStorage.length;o++){const a=localStorage.key(o);a.includes(e+"_")&&(t[n]=JSON.parse(localStorage.getItem(a)),n++)}return t},delete_node_fav=()=>{if(html_fav_book.children.length>0){const e=html_fav_book.children.length;for(let t=0;t<e;t++)html_fav_book.removeChild(html_fav_book.children[0])}};html_favorite_img.addEventListener("click",e=>{e.preventDefault();const t=select_favorite(sessionStorage.getItem("active"));if(t.length>0){modal_fav.style.display="block",delete_node_fav();const e=document.createDocumentFragment();for(let n=0;n<t.length;n++){const{key:o,img:a,user:i,title:l}=t[n],r=document.createElement("DIV"),s=document.createElement("IMG"),c=document.createElement("IMG"),m=document.createElement("P");r.setAttribute("id",o),s.setAttribute("src",a),c.setAttribute("src","./images/descarga (4).png"),c.setAttribute("class","icons_fav"),c.dataset.id=o,c.dataset.action="delete",c.dataset.key=i+"_"+o,m.textContent=l,r.appendChild(s),r.appendChild(c),r.appendChild(m),e.appendChild(r)}html_fav_book.appendChild(e)}}),html_fav_book.addEventListener("click",e=>{if(e.preventDefault(),"delete"==e.target.dataset.action&&(localStorage.removeItem(e.target.dataset.key),html_fav_book.removeChild(document.getElementById(e.target.dataset.id)),0==html_fav_book.children.length)){modal_fav.style.display="none",html_favorite_img.src="./images/descarga.png";let e=html_container.children.length;for(let t=0;t<e;t++){html_container.children[t].firstChild.nextSibling.src="./images/images.png"}}}),addEventListener("load",()=>{form_title.focus(),select_favorite(sessionStorage.getItem("active")).length>0&&(html_favorite_img.src="./images/images (3).jfif")}),html_back.addEventListener("click",()=>{location.href="/index.html",sessionStorage.removeItem("active")}),span.onclick=function(){modal.style.display="none",delete_node_info()},span_fav.onclick=function(){modal_fav.style.display="none",delete_node_info()};